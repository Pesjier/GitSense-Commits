# Activity Summary for 12/4/2025

## 11:15:18 AM
This development log outlines changes to a C++ project (PA1484) focused on a weather application for an embedded device with an AMOLED display, utilizing LVGL for the user interface and connecting to SMHI for weather data.

### File-Specific Updates:

1.  **`c:\C++Saker\projects\PA1484\PA1484\project\project.ino`**
    *   **Initial State (12/4/2025, 10:19:27 AM):** The file established the core structure of the weather application. It included numerous libraries for UI (LVGL, LilyGo_AMOLED), networking (WiFiHandler), and SMHI data processing. The UI was designed with a fullscreen tileview containing three main tiles: a splash screen (t0), a 7-day weather forecast (t1) populated with example "Karlskrona" data, and a graph display (t2) with placeholder coordinates. The `setup()` function handled device initialization, boot screen display, and WiFi connection. A section for SMHI API testing was present but partially commented out. A `SettingsScreen` was initialized with a listener to update forecast element locations, though initially only the location *name* was set.
    *   **SMHI Test Code Cleanup (12/4/2025, 10:23:15 AM - 10:23:26 AM):** Consecutive updates commented out the `buildURL` call and the subsequent `if (res)` block in the `setup()` function, removing the preliminary SMHI API test code.
    *   **SMHIForecastParser Integration Attempt (12/4/2025, 10:46:02 AM - 10:54:02 AM):** This period saw significant evolution in the `settings->AddListenerToLocation` lambda.
        *   Initially, an incomplete call to `forecast.parseJSONFromStation()` was added (10:46:02 AM).
        *   This was quickly corrected to `forecast.parseJSONFromStation(*newLocation.realStation)` (10:46:20 AM), passing the correct station object.
        *   The lambda was then enhanced to retrieve the parsed forecast data (`forecast.getAllData()`) and update the first `WeatherForecastElement` (`forecast_elements[0]`) with dynamic temperature, location, date, and weather symbol (12/4/2025, 10:51:16 AM).
        *   An intermediate, erroneous step duplicated the update for `forecast_elements[0]` seven times inside an empty loop (12/4/2025, 10:53:24 AM).
        *   This was promptly corrected to a proper `for` loop that iterates through all `forecast_elements` and updates each with its corresponding `ForecastDataPoint` from the parsed data (12/4/2025, 10:54:02 AM). This was a crucial step towards dynamic weather display.
    *   **Dynamic Forecast Update Reversion (12/4/2025, 11:11:43 AM - 11:11:49 AM):** The code responsible for fetching and updating forecast elements dynamically within the `settings->AddListenerToLocation` lambda was commented out, reverting `project.ino` to only update the location name based on settings changes.

2.  **`c:\C++Saker\projects\PA1484\PA1484\project\SMHIStationsAndParameters\StationAndParameterData.h`**
    *   **New File (12/4/2025, 10:26:51 AM):** This file was introduced or substantially updated to define a static function `FillWithStations`. This function populates a vector with over a hundred hardcoded `SMHIStation` objects, each containing a name, ID, latitude, longitude, and an additional numeric ID, providing a comprehensive list of available weather stations.

3.  **`c:\C++Saker\projects\PA1484\PA1484\project\ParserStuff\SMHIForecastParser.h`**
    *   **New File (12/4/2025, 10:38:46 AM):** This header file defined the `SMHIForecastParser` class, crucial for handling SMHI weather forecast data. It introduced a `ForecastDataPoint` struct to store individual forecast entries and declared methods for parsing JSON data from files, strings, or directly from an `SMHIStation` object. It also provided getter methods for various weather parameters (temperature, wind speed, humidity, pressure, precipitation) and overall data management.

4.  **`c:\C++Saker\projects\PA1484\PA1484\project\ParserStuff\SMHIForecastParser.cpp`**
    *   **Initial Implementation (12/4/2025, 10:38:58 AM):** This file provided the implementation for the `SMHIForecastParser` class. It included functions to parse date/time, identify noon data points, and extract forecast details from a JSON string using `ArduinoJson`. Initial `parseJSONFromStation` was a stub with a commented example URL.
    *   **URL Construction Refinement (12/4/2025, 10:40:31 AM - 10:41:47 AM):** Several rapid changes focused on correctly constructing the SMHI API URL within `parseJSONFromStation`. This involved incorporating `<sstream>` and fixing the syntax for concatenating string literals with float station coordinates into a `std::stringstream`.
    *   **Functional API Call (12/4/2025, 10:42:16 AM):** The `parseJSONFromStation` method was updated to actually call `extractForecastData` using the constructed URL string, indicating an attempt to fetch and process data from the SMHI API dynamically based on station coordinates.
    *   **Development TODO (12/4/2025, 11:11:10 AM):** A comment `//TODO: fix haha, just temp for funny example` was added to `parseJSONFromStation`, suggesting that while the URL construction and parsing logic are in place, the actual HTTP request and response handling to fetch live data from the API are still pending or in a mocked state.

### Patterns and Recurring Elements:

*   **SMHI API Integration:** A central theme is the continuous effort to integrate with the SMHI API, from initial placeholder tests to developing a dedicated parser and then attempting to dynamically fetch and display forecast data.
*   **UI (LVGL) Focus:** The project heavily relies on LVGL for building and managing the user interface, including tile views, labels, and custom elements like `WeatherForecastElement` and `Linegraf`.
*   **Incremental Development:** Changes often occur in small, rapid steps, demonstrating an iterative development process, where code is added, refined, and sometimes temporarily commented out (e.g., SMHI test code, dynamic forecast updates) for debugging or future implementation.
*   **Data Parsing and Management:** The introduction of `SMHIForecastParser` with its `ForecastDataPoint` struct highlights the need for structured data handling for external API responses.
*   **Hardcoded Data:** Initially, UI elements use hardcoded values (e.g., "Karlskrona", example forecast values). This is seen with the `FillWithStations` function which hardcodes a large list of stations, providing static lookup data before dynamic API interaction is fully realized.
*   **WiFi Connectivity:** WiFi setup and status updates are consistently present, indicating that network access is a fundamental requirement for the application.

## 12:16:38 PM
The code changes primarily focus on developing a weather application for an embedded device using the LVGL UI library, integrating with SMHI (Swedish Meteorological and Hydrological Institute) data, and handling Wi-Fi connectivity.

**File-specific Updates:**

*   **`c:\C++Saker\projects\PA1484\PA1484\project\project.ino`**
    *   **12/4/2025, 10:19:27 AM:** The initial version sets up the LVGL UI with a tileview (`t0`, `t1`, `t2`), including a 7-day weather forecast display (`forecast_elements`) and a graph display (`grafobj`, `mygrafobj`). It includes a boot screen and Wi-Fi connection logic. SMHI data fetching (parameters and stations) is initiated in `setup()`, with placeholder values for forecast elements.
    *   **12/4/2025, 10:23:15 AM - 10:23:26 AM:** Debugging lines related to SMHI URL building and heap memory prints are commented out, indicating testing or temporary disablement of certain SMHI API interactions.
    *   **12/4/2025, 10:46:02 AM - 10:55:16 AM:** Significant updates within the `settings->AddListenerToLocation` lambda. Initially, a call to `SMHIForecastParser::parseJSONFromStation()` was added, then corrected to pass the station object. This was followed by an iterative implementation to extract `ForecastDataPoint`s and dynamically update all 7 `WeatherForecastElement` instances with temperature, location, date, and weather symbol based on parsed SMHI data.
    *   **12/4/2025, 11:11:49 AM:** The entire dynamic data update logic within the `AddListenerToLocation` lambda (SMHIForecastParser instantiation and `forecast_elements` update loop) is commented out, possibly for testing other parts or due to issues with the SMHI API integration at that moment.
    *   **12/4/2025, 11:36:25 AM:** UI adjustments for the graph tile (`t2`). The `t2_label` object and its related styling are removed. New static `lv_obj_t*` pointers, `graphTitle` and `graphDescription`, are introduced for the graph screen, preparing for dynamic graph labeling.
    *   **12/4/2025, 11:39:53 AM - 11:42:11 AM:** Creation and styling of `graphTitle` and `graphDescription` labels on `t2`. The `graphTitle` is set to an empty string, and `graphDescription` is created and styled with a smaller font (`lv_font_montserrat_16`).
    *   **12/4/2025, 11:42:46 AM - 11:46:33 AM:** A new listener `settings->AddListenerToCondition` is added. This listener is designed to react to changes in the selected weather parameter (condition) and dynamically update the `graphTitle` and `graphDescription` labels with the `title` and `description` of the chosen `DropdownParameter`.
    *   **12/4/2025, 11:50:49 AM:** Added `Serial.println(ESP.getFreePsram());` in `setup()` for debugging PSRAM usage.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\SMHIStationsAndParameters\StationAndParameterData.h`**
    *   **12/4/2025, 10:26:51 AM:** This file was introduced or significantly updated to include a comprehensive list of pre-defined SMHI weather stations, which are populated into a `std::vector<SMHIStation*>` via the `FillWithStations` static function.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\ParserStuff\SMHIForecastParser.h`**
    *   **12/4/2025, 10:38:46 AM:** Initializes the `SMHIForecastParser` class, defining a `ForecastDataPoint` struct and methods for parsing JSON data (from file, string, or SMHI station), extracting various weather data (temperature, wind speed, etc.), and managing forecast data. The `parseJSONFromStation` method was initially declared with an incomplete parameter list.
    *   **12/4/2025, 11:49:01 AM - 11:49:27 AM:** Minor, rapid changes to the declarations of `parseJSONFromFile` (adding, then removing, a dummy integer parameter) and `funny` (adding, then changing parameters of, a global function). These appear to be quick tests or refactoring steps that were mostly reverted.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\ParserStuff\SMHIForecastParser.cpp`**
    *   **12/4/2025, 10:38:58 AM:** Implements the `SMHIForecastParser` methods. Key logic includes parsing JSON from `timeSeries` to extract noon forecast data points (temperature, wind speed, humidity, pressure, precipitation, weather symbol), and handling potential string/number types for JSON values. The `parseJSONFromStation` method was a stub.
    *   **12/4/2025, 10:40:31 AM - 10:41:47 AM:** Evolutions in `parseJSONFromStation`. Initially, an attempt to construct an SMHI API URL string using `station.longitude` and `station.latitude` was made, which was then corrected to use `std::stringstream` for proper concatenation of `float` values.
    *   **12/4/2025, 10:42:16 AM:** The `parseJSONFromStation` method is updated to actually call `extractForecastData()` with the constructed URL string, making it functional for fetching and parsing data from the specified station.
    *   **12/4/2025, 10:44:46 AM:** A minor adjustment to cast the `stringstream` output to `c_str()`.
    *   **12/4/2025, 11:11:10 AM:** A `//TODO` comment is added to `parseJSONFromStation`, indicating it's still considered temporary or requires further work.
    *   **12/4/2025, 11:49:20 AM - 11:49:42 AM:** A global `funny` function is briefly added and then removed, correlating with changes in the header file.

*   **`c:\C++Saker\projects\PA1484\PA1484\src\lv_conf.h`**
    *   **12/4/2025, 12:01:41 PM - 12:13:11 PM:** This file consistently defines LVGL configuration settings. Key configurations include `LV_COLOR_DEPTH 16`, custom memory management using `ps_malloc` (PSRAM, for ESP32 systems), custom tick source using `millis()`, and enabling complex drawing features (`LV_DRAW_COMPLEX 1`). All recorded changes in this file are identical, suggesting no functional modifications during this log period.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\BootScreen.cpp`**
    *   **12/4/2025, 12:06:18 PM - 12:06:25 PM:** This file implements a boot screen with a "Weather app" logo, version "v1.0", and "Grupp 9" text, along with drop and flash animations using LVGL. No functional changes were recorded between the two timestamps.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\SettingsScreen.cpp`**
    *   **12/4/2025, 12:10:41 PM - 12:10:49 PM:** This file implements a settings screen as a popup with open/close buttons, two dropdowns for selecting locations and conditions (weather parameters), and save/load default buttons that use `Preferences` for persistence. It defines listeners to update dropdown content based on selections. No functional changes were recorded between the two timestamps.

**Patterns and Recurring Elements:**

*   **LVGL UI Focus:** A strong emphasis on building and modifying the graphical user interface using the LVGL library is evident across multiple files, including tile views, labels, buttons, and animations.
*   **SMHI Data Integration:** There's a continuous effort to integrate with SMHI weather data, including defining stations and parameters, parsing JSON forecasts, and dynamically updating UI elements based on this data.
*   **Dynamic UI Updates:** A recurring pattern is the use of listeners (e.g., `AddListenerToLocation`, `AddListenerToCondition`) in the `SettingsScreen` to trigger updates on other UI components (like `WeatherForecastElement` or graph labels) when user selections change.
*   **Debugging and Iteration:** Frequent small changes, particularly commenting out and uncommenting code blocks (like SMHI API calls or memory prints in `project.ino`), indicate an active, iterative development and debugging process. The rapid sequence of changes in `SMHIForecastParser.h` and `.cpp` also highlights this.
*   **Embedded System Considerations:** The use of `ps_malloc` in `lv_conf.h` and printing `ESP.getFreePsram()` explicitly points to development for an ESP32-based embedded system that leverages external PSRAM for memory-intensive UI operations.
*   **Code Organization:** The project structure with dedicated files for `BootScreen`, `SettingsScreen`, `SMHIStationsAndParameters`, and `ParserStuff` suggests a modular approach to development.
*   **Hardcoded WiFi Credentials:** The Wi-Fi credentials "BTH_Guest" and "papaya21turkos" are hardcoded in `project.ino`.

## 1:15:18 PM
The log primarily details a focused development session on a C++ weather application for an embedded system, likely an ESP32 with an AMOLED display, utilizing the LVGL UI library and integrating with the SMHI weather API. All changes occurred on **12/4/2025**.

Here's a breakdown of the key information:

**File-Specific Updates:**

*   **`c:\C++Saker\projects\PA1484\PA1484\project\project.ino` (10:23:26 AM - 1:06:24 PM):**
    *   Initial setup defined a weather application UI with three main tiles for welcome, a 7-day forecast, and a graph. The UI uses `LilyGo_AMOLED` and `LVGL` components, including `WeatherForecastElement` for forecast display and `Linegraf` for plotting.
    *   A `SettingsScreen` was integrated, allowing users to select locations and weather conditions. Listeners were added to update UI elements based on these selections.
    *   The code evolved to actively fetch and parse SMHI data. Initially, placeholders were used for forecast values, which were then replaced with logic to dynamically update them using data from `SMHIForecastParser`.
    *   Extensive refactoring of UI elements, including declaring new `graphTitle` and `graphDescription` labels for the graph tile. Font types for various labels (`t0_label`, `graphTitle`, `graphDescription`, `open_image`) were changed to `arial_32`, `arial_16`, or `arial_20` for consistency.
    *   Debug `Serial.println` statements were progressively added to trace API calls and parsing steps. Memory usage (`ESP.getFreeHeap()`, `ESP.getFreePsram()`) was also logged.
    *   WiFi credentials (`WiFiHandler wifi(...)`) were modified multiple times.
    *   The `settings->LoadDefaultValues()` call was moved from `create_ui()` to the end of `setup()`, indicating a change in initialization flow.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\SMHIStationsAndParameters\StationAndParameterData.h` (10:26:51 AM):**
    *   This file serves as a static data repository, containing a large `FillWithStations` function. This function hardcodes a comprehensive list of SMHI weather stations with their names, keys, and geographical coordinates. This data remains unchanged throughout the log.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\ParserStuff\SMHIForecastParser.h` (10:38:46 AM - 12:46:22 PM):**
    *   Defined the `SMHIForecastParser` class and `ForecastDataPoint` structure. The `ForecastDataPoint` holds parsed weather data (year, month, day, temperature, wind speed, humidity, pressure, precipitation, weather symbol).
    *   The class provides methods for parsing JSON data from various sources (file, string, SMHI station).
    *   A new public method `bool getDataFromJSON(JsonDocument& doc);` was introduced at 12:46:17 PM to allow parsing data directly from a provided `JsonDocument`.
    *   Minor, transient changes were made to function signatures (e.g., `parseJSONFromFile` temporarily gaining an extra parameter, a global `funny` function being added and removed).

*   **`c:\C++Saker\projects\PA1484\PA1484\project\ParserStuff\SMHIForecastParser.cpp` (10:38:58 AM - 1:10:27 PM):**
    *   Implemented the parsing logic for `SMHIForecastParser`, including `parseDateTime` and `isNoonTime` to filter for 12:00 PM forecast data.
    *   The `extractForecastData` method handles deserialization of JSON strings, gracefully managing cases where data fields might be strings or numbers.
    *   The `parseJSONFromStation` method was enhanced to construct a dynamic SMHI API URL using station coordinates and subsequently attempt to fetch and parse the data. Initial implementations returned `false`, but were later updated to use `extractForecastData` and return `forecastData.size() > 0`.
    *   The new `getDataFromJSON` method was implemented to process a pre-existing `JsonDocument`, extracting and storing forecast points.
    *   Debug output (`Serial.println`) was added within `getDataFromJSON` to trace execution flow during parsing.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\SMHIAPI\SMHIAPI.h` (12:30:56 PM - 12:39:26 PM):**
    *   Declared functions for secure HTTPS GET requests (`httpsGetJson`, `httpsGetCSV`) and a `buildURL` function for SMHI API endpoints.
    *   The `buildURL` function's `JsonDocument` parameter was updated from pass-by-value to pass-by-reference at 12:31:15 PM and the `SMHIStation` parameter was made `const` at 12:39:26 PM.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\SMHIAPI\SMHIAPI.cpp` (12:31:20 PM - 12:43:36 PM):**
    *   Provided the implementation for the SMHI API interaction functions, including SSL client setup with `client.setInsecure()`.
    *   The `buildURL` logic concatenates strings to form the SMHI API request URL for specific parameters and stations.
    *   Debugging output was added to `httpsGetJson` to monitor HTTP response codes, content length, and payload size.
    *   The signature of `buildURL` was updated to reflect the header changes (passing `JsonDocument` by reference and `SMHIStation` by const reference).

*   **`c:\C++Saker\projects\PA1484\PA1484\src\lv_conf.h` (12:01:41 PM - 12:22:18 PM):**
    *   LVGL configuration file. Configures display color depth (`LV_COLOR_DEPTH 16`), custom memory allocation using `ps_malloc` from `esp32-hal-psram.h` for PSRAM, and various drawing/feature settings. This file remained largely stable after its initial state in this log.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\BootScreen.cpp` (12:06:18 PM - 12:06:25 PM):**
    *   Implemented the boot screen with animations for "Weather app" logo and a flash effect. Uses `arial_32` for text.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\SettingsScreen.cpp` (12:10:41 AM - 12:44:43 PM):**
    *   Implemented the settings popup, including buttons for opening/closing the settings, dropdowns for selecting weather locations and conditions, and "Save Default" and "Load Default" buttons which use `Preferences` for persistence.
    *   Listeners were established to update the list of eligible stations when the selected weather parameter changes and to dynamically update the `graphTitle` and `graphDescription` based on the chosen parameter.
    *   Font types were updated to `arial_32` for `open_image` and `arial_20` for other labels.

**Patterns and Recurring Elements:**

*   **LVGL UI Focus:** A significant portion of the changes revolves around setting up and refining the graphical user interface using LVGL, including tile views, labels, buttons, and dropdowns. This indicates active UI development and layout adjustments.
*   **SMHI API Data Handling:** There's a clear emphasis on integrating with the SMHI weather API, from defining stations and parameters, constructing API URLs, making HTTPS requests, to parsing the received JSON data into a structured format for display.
*   **Data Parsing Refinement:** Multiple commits show iterative improvements and debugging in the `SMHIForecastParser` class, including adding `stringstream`, correcting URL construction, and implementing a dedicated method (`getDataFromJSON`) for parsing JSON documents. Debug print statements are a common tool used.
*   **Memory Management:** The project utilizes `ps_malloc` for dynamic memory allocation, and memory monitoring (`ESP.getFreeHeap()`, `ESP.getFreePsram()`) is explicitly added, suggesting performance or memory constraint considerations typical of embedded development.
*   **Font Consistency:** A pattern of updating font usage (e.g., from `montserrat` to `arial`) is observed across different UI components, indicating an effort towards a standardized visual style.
*   **Functionality Flow:** Changes in `project.ino` and `SettingsScreen.cpp` show the establishment of an event-driven flow where user selections in settings (location, parameter) trigger data fetching and UI updates.
*   **Hardcoded Data vs. Dynamic Fetching:** The `StationAndParameterData.h` file containing hardcoded station data contrasts with the dynamic API fetching logic, suggesting a hybrid approach or a phase where static data is used for testing/initialization before full dynamic integration.