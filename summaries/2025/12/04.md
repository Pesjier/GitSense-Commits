# Activity Summary for 12/4/2025

## 11:15:18 AM
This development log outlines changes to a C++ project (PA1484) focused on a weather application for an embedded device with an AMOLED display, utilizing LVGL for the user interface and connecting to SMHI for weather data.

### File-Specific Updates:

1.  **`c:\C++Saker\projects\PA1484\PA1484\project\project.ino`**
    *   **Initial State (12/4/2025, 10:19:27 AM):** The file established the core structure of the weather application. It included numerous libraries for UI (LVGL, LilyGo_AMOLED), networking (WiFiHandler), and SMHI data processing. The UI was designed with a fullscreen tileview containing three main tiles: a splash screen (t0), a 7-day weather forecast (t1) populated with example "Karlskrona" data, and a graph display (t2) with placeholder coordinates. The `setup()` function handled device initialization, boot screen display, and WiFi connection. A section for SMHI API testing was present but partially commented out. A `SettingsScreen` was initialized with a listener to update forecast element locations, though initially only the location *name* was set.
    *   **SMHI Test Code Cleanup (12/4/2025, 10:23:15 AM - 10:23:26 AM):** Consecutive updates commented out the `buildURL` call and the subsequent `if (res)` block in the `setup()` function, removing the preliminary SMHI API test code.
    *   **SMHIForecastParser Integration Attempt (12/4/2025, 10:46:02 AM - 10:54:02 AM):** This period saw significant evolution in the `settings->AddListenerToLocation` lambda.
        *   Initially, an incomplete call to `forecast.parseJSONFromStation()` was added (10:46:02 AM).
        *   This was quickly corrected to `forecast.parseJSONFromStation(*newLocation.realStation)` (10:46:20 AM), passing the correct station object.
        *   The lambda was then enhanced to retrieve the parsed forecast data (`forecast.getAllData()`) and update the first `WeatherForecastElement` (`forecast_elements[0]`) with dynamic temperature, location, date, and weather symbol (12/4/2025, 10:51:16 AM).
        *   An intermediate, erroneous step duplicated the update for `forecast_elements[0]` seven times inside an empty loop (12/4/2025, 10:53:24 AM).
        *   This was promptly corrected to a proper `for` loop that iterates through all `forecast_elements` and updates each with its corresponding `ForecastDataPoint` from the parsed data (12/4/2025, 10:54:02 AM). This was a crucial step towards dynamic weather display.
    *   **Dynamic Forecast Update Reversion (12/4/2025, 11:11:43 AM - 11:11:49 AM):** The code responsible for fetching and updating forecast elements dynamically within the `settings->AddListenerToLocation` lambda was commented out, reverting `project.ino` to only update the location name based on settings changes.

2.  **`c:\C++Saker\projects\PA1484\PA1484\project\SMHIStationsAndParameters\StationAndParameterData.h`**
    *   **New File (12/4/2025, 10:26:51 AM):** This file was introduced or substantially updated to define a static function `FillWithStations`. This function populates a vector with over a hundred hardcoded `SMHIStation` objects, each containing a name, ID, latitude, longitude, and an additional numeric ID, providing a comprehensive list of available weather stations.

3.  **`c:\C++Saker\projects\PA1484\PA1484\project\ParserStuff\SMHIForecastParser.h`**
    *   **New File (12/4/2025, 10:38:46 AM):** This header file defined the `SMHIForecastParser` class, crucial for handling SMHI weather forecast data. It introduced a `ForecastDataPoint` struct to store individual forecast entries and declared methods for parsing JSON data from files, strings, or directly from an `SMHIStation` object. It also provided getter methods for various weather parameters (temperature, wind speed, humidity, pressure, precipitation) and overall data management.

4.  **`c:\C++Saker\projects\PA1484\PA1484\project\ParserStuff\SMHIForecastParser.cpp`**
    *   **Initial Implementation (12/4/2025, 10:38:58 AM):** This file provided the implementation for the `SMHIForecastParser` class. It included functions to parse date/time, identify noon data points, and extract forecast details from a JSON string using `ArduinoJson`. Initial `parseJSONFromStation` was a stub with a commented example URL.
    *   **URL Construction Refinement (12/4/2025, 10:40:31 AM - 10:41:47 AM):** Several rapid changes focused on correctly constructing the SMHI API URL within `parseJSONFromStation`. This involved incorporating `<sstream>` and fixing the syntax for concatenating string literals with float station coordinates into a `std::stringstream`.
    *   **Functional API Call (12/4/2025, 10:42:16 AM):** The `parseJSONFromStation` method was updated to actually call `extractForecastData` using the constructed URL string, indicating an attempt to fetch and process data from the SMHI API dynamically based on station coordinates.
    *   **Development TODO (12/4/2025, 11:11:10 AM):** A comment `//TODO: fix haha, just temp for funny example` was added to `parseJSONFromStation`, suggesting that while the URL construction and parsing logic are in place, the actual HTTP request and response handling to fetch live data from the API are still pending or in a mocked state.

### Patterns and Recurring Elements:

*   **SMHI API Integration:** A central theme is the continuous effort to integrate with the SMHI API, from initial placeholder tests to developing a dedicated parser and then attempting to dynamically fetch and display forecast data.
*   **UI (LVGL) Focus:** The project heavily relies on LVGL for building and managing the user interface, including tile views, labels, and custom elements like `WeatherForecastElement` and `Linegraf`.
*   **Incremental Development:** Changes often occur in small, rapid steps, demonstrating an iterative development process, where code is added, refined, and sometimes temporarily commented out (e.g., SMHI test code, dynamic forecast updates) for debugging or future implementation.
*   **Data Parsing and Management:** The introduction of `SMHIForecastParser` with its `ForecastDataPoint` struct highlights the need for structured data handling for external API responses.
*   **Hardcoded Data:** Initially, UI elements use hardcoded values (e.g., "Karlskrona", example forecast values). This is seen with the `FillWithStations` function which hardcodes a large list of stations, providing static lookup data before dynamic API interaction is fully realized.
*   **WiFi Connectivity:** WiFi setup and status updates are consistently present, indicating that network access is a fundamental requirement for the application.

## 12:16:38 PM
The code changes primarily focus on developing a weather application for an embedded device using the LVGL UI library, integrating with SMHI (Swedish Meteorological and Hydrological Institute) data, and handling Wi-Fi connectivity.

**File-specific Updates:**

*   **`c:\C++Saker\projects\PA1484\PA1484\project\project.ino`**
    *   **12/4/2025, 10:19:27 AM:** The initial version sets up the LVGL UI with a tileview (`t0`, `t1`, `t2`), including a 7-day weather forecast display (`forecast_elements`) and a graph display (`grafobj`, `mygrafobj`). It includes a boot screen and Wi-Fi connection logic. SMHI data fetching (parameters and stations) is initiated in `setup()`, with placeholder values for forecast elements.
    *   **12/4/2025, 10:23:15 AM - 10:23:26 AM:** Debugging lines related to SMHI URL building and heap memory prints are commented out, indicating testing or temporary disablement of certain SMHI API interactions.
    *   **12/4/2025, 10:46:02 AM - 10:55:16 AM:** Significant updates within the `settings->AddListenerToLocation` lambda. Initially, a call to `SMHIForecastParser::parseJSONFromStation()` was added, then corrected to pass the station object. This was followed by an iterative implementation to extract `ForecastDataPoint`s and dynamically update all 7 `WeatherForecastElement` instances with temperature, location, date, and weather symbol based on parsed SMHI data.
    *   **12/4/2025, 11:11:49 AM:** The entire dynamic data update logic within the `AddListenerToLocation` lambda (SMHIForecastParser instantiation and `forecast_elements` update loop) is commented out, possibly for testing other parts or due to issues with the SMHI API integration at that moment.
    *   **12/4/2025, 11:36:25 AM:** UI adjustments for the graph tile (`t2`). The `t2_label` object and its related styling are removed. New static `lv_obj_t*` pointers, `graphTitle` and `graphDescription`, are introduced for the graph screen, preparing for dynamic graph labeling.
    *   **12/4/2025, 11:39:53 AM - 11:42:11 AM:** Creation and styling of `graphTitle` and `graphDescription` labels on `t2`. The `graphTitle` is set to an empty string, and `graphDescription` is created and styled with a smaller font (`lv_font_montserrat_16`).
    *   **12/4/2025, 11:42:46 AM - 11:46:33 AM:** A new listener `settings->AddListenerToCondition` is added. This listener is designed to react to changes in the selected weather parameter (condition) and dynamically update the `graphTitle` and `graphDescription` labels with the `title` and `description` of the chosen `DropdownParameter`.
    *   **12/4/2025, 11:50:49 AM:** Added `Serial.println(ESP.getFreePsram());` in `setup()` for debugging PSRAM usage.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\SMHIStationsAndParameters\StationAndParameterData.h`**
    *   **12/4/2025, 10:26:51 AM:** This file was introduced or significantly updated to include a comprehensive list of pre-defined SMHI weather stations, which are populated into a `std::vector<SMHIStation*>` via the `FillWithStations` static function.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\ParserStuff\SMHIForecastParser.h`**
    *   **12/4/2025, 10:38:46 AM:** Initializes the `SMHIForecastParser` class, defining a `ForecastDataPoint` struct and methods for parsing JSON data (from file, string, or SMHI station), extracting various weather data (temperature, wind speed, etc.), and managing forecast data. The `parseJSONFromStation` method was initially declared with an incomplete parameter list.
    *   **12/4/2025, 11:49:01 AM - 11:49:27 AM:** Minor, rapid changes to the declarations of `parseJSONFromFile` (adding, then removing, a dummy integer parameter) and `funny` (adding, then changing parameters of, a global function). These appear to be quick tests or refactoring steps that were mostly reverted.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\ParserStuff\SMHIForecastParser.cpp`**
    *   **12/4/2025, 10:38:58 AM:** Implements the `SMHIForecastParser` methods. Key logic includes parsing JSON from `timeSeries` to extract noon forecast data points (temperature, wind speed, humidity, pressure, precipitation, weather symbol), and handling potential string/number types for JSON values. The `parseJSONFromStation` method was a stub.
    *   **12/4/2025, 10:40:31 AM - 10:41:47 AM:** Evolutions in `parseJSONFromStation`. Initially, an attempt to construct an SMHI API URL string using `station.longitude` and `station.latitude` was made, which was then corrected to use `std::stringstream` for proper concatenation of `float` values.
    *   **12/4/2025, 10:42:16 AM:** The `parseJSONFromStation` method is updated to actually call `extractForecastData()` with the constructed URL string, making it functional for fetching and parsing data from the specified station.
    *   **12/4/2025, 10:44:46 AM:** A minor adjustment to cast the `stringstream` output to `c_str()`.
    *   **12/4/2025, 11:11:10 AM:** A `//TODO` comment is added to `parseJSONFromStation`, indicating it's still considered temporary or requires further work.
    *   **12/4/2025, 11:49:20 AM - 11:49:42 AM:** A global `funny` function is briefly added and then removed, correlating with changes in the header file.

*   **`c:\C++Saker\projects\PA1484\PA1484\src\lv_conf.h`**
    *   **12/4/2025, 12:01:41 PM - 12:13:11 PM:** This file consistently defines LVGL configuration settings. Key configurations include `LV_COLOR_DEPTH 16`, custom memory management using `ps_malloc` (PSRAM, for ESP32 systems), custom tick source using `millis()`, and enabling complex drawing features (`LV_DRAW_COMPLEX 1`). All recorded changes in this file are identical, suggesting no functional modifications during this log period.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\BootScreen.cpp`**
    *   **12/4/2025, 12:06:18 PM - 12:06:25 PM:** This file implements a boot screen with a "Weather app" logo, version "v1.0", and "Grupp 9" text, along with drop and flash animations using LVGL. No functional changes were recorded between the two timestamps.

*   **`c:\C++Saker\projects\PA1484\PA1484\project\SettingsScreen.cpp`**
    *   **12/4/2025, 12:10:41 PM - 12:10:49 PM:** This file implements a settings screen as a popup with open/close buttons, two dropdowns for selecting locations and conditions (weather parameters), and save/load default buttons that use `Preferences` for persistence. It defines listeners to update dropdown content based on selections. No functional changes were recorded between the two timestamps.

**Patterns and Recurring Elements:**

*   **LVGL UI Focus:** A strong emphasis on building and modifying the graphical user interface using the LVGL library is evident across multiple files, including tile views, labels, buttons, and animations.
*   **SMHI Data Integration:** There's a continuous effort to integrate with SMHI weather data, including defining stations and parameters, parsing JSON forecasts, and dynamically updating UI elements based on this data.
*   **Dynamic UI Updates:** A recurring pattern is the use of listeners (e.g., `AddListenerToLocation`, `AddListenerToCondition`) in the `SettingsScreen` to trigger updates on other UI components (like `WeatherForecastElement` or graph labels) when user selections change.
*   **Debugging and Iteration:** Frequent small changes, particularly commenting out and uncommenting code blocks (like SMHI API calls or memory prints in `project.ino`), indicate an active, iterative development and debugging process. The rapid sequence of changes in `SMHIForecastParser.h` and `.cpp` also highlights this.
*   **Embedded System Considerations:** The use of `ps_malloc` in `lv_conf.h` and printing `ESP.getFreePsram()` explicitly points to development for an ESP32-based embedded system that leverages external PSRAM for memory-intensive UI operations.
*   **Code Organization:** The project structure with dedicated files for `BootScreen`, `SettingsScreen`, `SMHIStationsAndParameters`, and `ParserStuff` suggests a modular approach to development.
*   **Hardcoded WiFi Credentials:** The Wi-Fi credentials "BTH_Guest" and "papaya21turkos" are hardcoded in `project.ino`.